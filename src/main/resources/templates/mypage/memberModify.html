<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="https://www.thymelaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>정보수정</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link href="/css/common/common.css" rel="stylesheet">
<link href="/css/mypage/memberModify.css" rel="stylesheet">
</head>
<body>
<header th:include="common/header :: header"></header>
	<div id="container">
        <nav class="snb" th:replace="/mypage/mypageSubmenu.html">
        </nav>
        <div class="contents">
            <div class="inner">
                
                <div>
                    <h3 style="font-size: 24px;">정보수정</h3>
                </div>
                <hr style="width: 700px; padding-right: 130px;">
                <form style="margin-left: 150px;" th:action="@{/mypage/memberModify}" method="post">
                	<input type="hidden" id="user_no" name="user_no" th:value=${m.user_no}>
                    <p style="font-size: 18px;">아이디</p>
                    <input type="text" name="user_id" class="inputbox" readonly th:value="${m.user_id}">
                    <p style="font-size: 18px;">비밀번호</p>
                    <input type="password" name="user_pw" class="inputbox" th:value="${m.user_pw}"> 
                    <button onclick="modifyPwd()">변경</button>
                    <p style="font-size: 18px;">닉네임</p>
                    <input type="text" name="user_nickname" class="inputbox" th:value="${m.user_nickname}"> <button id="nickCheck">중복확인</button>
                    <p style="font-size: 18px;">이름</p>
                    <input type="text" name="user_name" class="inputbox" th:value="${m.user_name}">
                    <p style="font-size: 18px;">생년월일</p>
                    <input type="text" name="user_birth" class="inputbox" readonly th:value="${#dates.format(m.user_birth, 'yyyy-MM-dd')}">
                    <p style="font-size: 18px;">전화번호</p>
                    <input type="tel" name="user_phone" class="inputbox" th:value="${m.user_phone}">

                    <div class="cmd">
                        <!-- <input type="submit" name="save" id="save" value="저장"> -->
                        <button name="save" id="save" type="submit">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        $("#idCheck").click(function(){
			var nickname = $("[name=nickname]");
			// 중복 시 false, 아이디 사용 가능 시 true
			var isUsable = false;
			
			if(!nickname || nickname.val().length < 4){
				alert('아이디는 최소 2자리 이상이여야 합니다.');
				nickname.focus();
			} else {
				// 2자리 이상의 userId 값을 입력 했을 경우 중복 확인을 위해 ajax 통신 요청
				$.ajax({
					url : "",
					type : "post",
					data : { nickname : userId.val() },
					success : function(result){
						console.log(result);
						if(result == "fail"){
							alert("사용할 수  없는 아이디입니다.");
							nickname.focus();
						} else {
							if(confirm('사용가능한 닉네임입니다. 사용하시겠습니까?')){
								// 더 이상 id입력 공간을 수정할 수 없도록 readonly 처리
								nickname.attr('readonly', true);
								isUsable = true; // 사용 가능한 아이디라는 falg값
							} else {
								// confirm 창에서 취소를 누를 경우(처음, 또는 반복해서) 다시 수정 가능하도록
								nickname.attr('readonly', false);
								nickname.focus();
								isUsable = false; // 사용 불가능한 아이디라는 flag 값
							}
						}
						// 중복 체크 후 중복이 아니면 사용하겠다고 선택한 경우에만
						// joinBtn disabled 제거
						if(isUsable){
							$("#save").removeAttr("disabled");
						} else {
							$("#save").attr("disabled", true);
						}
					},
					error : function(e){
						console.log(e);
					}
				});
			}
		});
    </script>

    <script>
        function modifyPwd(){
            window.open("/mypage/pwdModify", "popup1", "width=500, height=600");
        }
    </script>
    <footer th:include="common/footer :: footer"></footer>
</body>
</html>