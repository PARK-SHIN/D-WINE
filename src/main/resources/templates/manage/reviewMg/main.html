<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>리뷰관리</title>
<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
<link href="/css/common/common.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
    <style>
    * {
          font-family: 'Gowun Batang', serif;
       }
    
    	#container {
	    width: 1100px;
	    margin: 0 auto;
	    display: flex;
	    justify-content: space-between;
	    flex-wrap: nowrap;
	    border: none;
	    height: 1400px;
		}
	
	.snb {
	    width: 200px;
	    /* height: 2500px; */
	    height: 100%;
	    border: 1px solid blue;
	}
	
        .content {
             width: 840px;
	    	height: 100%;
	    
        }
        
        .inner {
	    margin-top: 30px;
	    margin-left: 27px;
	    width: 795px;
	    /* height: 100%; */
	    border: none;
	}
	a {
	    text-decoration: none;
	    color: #000;
	}
	
	.snb {
	    width: 210px;
	}
	
	.snb_inner {
	    width: 170px;
	    margin: 30px auto 0;
	}
	
        #deleteBtn{
            float: right;
            background: #83131E ;
            border: none;
            color:white;
            width:80px;
            height: 25px;
            border-radius: 5px;
            margin-right: 20px;
            
        }

        .reviewMgList{
            text-align: center;
            margin-top: 30px;
            margin-bottom: 30px;
            width: 900px;
            height: 500px;
        }
        
        .reviewMgTable{
       	width: 840px;
	    text-align: center;
	    font-weight: lighter;
	    border-collapse: collapse;
	    font-size: 14px;
        }

        .reviewMgTable th{
        font-weight: lighter;
	    background-color: rgba(196, 196, 196, 0.3);
	    border: none;
        }
        
        .reviewMgTable tr {
	    height: 35px;
		}
		
		.reviewMgTable tr:nth-child(n+2):hover {
	    background-color: rgba(196, 196, 196, 0.1);
		}

        .reviewMgTable td{
        border-bottom:1px solid lightgray;
        border-left: none;
        text-align: center;
        height: 35px;
        font-size: 14px;
        }
        
        .reviewText{ 
        text-overflow: ellpsis; 
        white-space: nowrap; 
        max-width: 70px;
        }

        /* 체크박스 색상 변경 */
        input[type="checkbox"] {
        cursor: pointer;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        outline: 1px solid gray;
        background: white;
        height: 12.8px;
        width: 12.8px;
        border: 1px solid white;
        }

        input[type="checkbox"]:checked {
        background: #83131E;
        }

        input[type="checkbox"]:hover {
        filter: brightness(90%);
        }

        input[type="checkbox"]:after {
        content: '';
        position: relative;
        left: 40%;
        top: 20%;
        width: 15%;
        height: 40%;
        border: solid #fff;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
        display: none;
        }
            /* 페이징 부분 */
	.paging_ul {
		height: 50px;
		line-height: 50px;
		display: flex;
		justify-content: center;
		list-style: none;
		width: 480px;
		margin: 30px auto;
	}
	.paging_ul li {
		text-decoration: none;
		display: block;
		text-align: center;
		border: 1px solid #dae0e9;
	    margin-left: 10px;
		width: 37px;
		height: 37px;
		line-height : 37px;
	    font-size: 12px;
	    border-radius : 5px;
	}
	.current_page {
		border: 1px solid  #83131E;
	    background:  #83131E;
	    color: white;
	    border-radius : 5px;
	}


    </style>
</head>
<body>
<header th:include="common/header :: header"></header>
 <div id="container">
        <nav class="snb" th:replace="/manage/adminSubmenu.html"></nav>
        <script>
        $(document).ready(function () { 
            $('.reviewMg').css('background-color', 'rgba(131, 19, 30, 0.2)'); 
            $('.reviewMg').css('color', 'rgb(131,19,30)'); 
            $('.reviewMg').css('font-weight', 'bold'); 
        });
        </script>
<div class="content">
    <h2>리뷰관리</h2>    
    <hr>
    <button id="deleteBtn" onclick="deleteValue();">삭제</button><br>
   <!--  <label>정렬 : </label>
    <select name="array">
        <option value="latest">최신순</option>
        <option value="report-count">신고수</option>
    </select> 기능 상 의미가 없는 것같다.  -->
    <div class="reviewMgList">
            <table class="reviewMgTable">
            <tr>
                <th><input type="checkbox" class="allCheck"  name="allCheck"></th>
                <th>작성자(id)</th>
                <th>리뷰내용</th>
                <th>등록 날짜</th>
                <th>신고사유</th>
                <th>최근 신고자</th>
                <th>신고날짜</th>
                <th>신고 수</th>
            </tr>
            <tr th:each="report: ${ reviewMgList }" th:style="${report.count == 0 ? 'background-color:none' : 'background-color:rgba(180,19,30,0.1);'}">
                <td><input type="checkbox" class="checkbox"  id="checkbox" name="checkbox" th:value="${ report.review_no1 }" onclick="event.cancelBubble=true"></td>  
                <td th:text="${ report.user_id2 }"/>
                <td class="reviewText" onclick="openDetail();" th:text="${ report.review_text }"></td>
                <td th:text="${ #dates.format(report.review_date, 'yyyy-MM-dd') }"></td>
                <td  th:text="${ report.reason_context }"></td>
                <td th:text="${ report.user_id1 }"></td>
                <td th:text="${ #dates.format(report.report_date, 'yyyy-MM-dd') }"></td>
                <td th:text="${ report.count }">
            </tr>  
        </table>    
   
    </div>

	<!-- 페이징 -->
 			<div class="paging__area">
			 	<ul class="paging_ul">
					<li class="go_first">&lt;&lt;</li>
					<li class="go_prev">&lt;</li>
					<li class="pageNo current_page" th:each="page: ${#numbers.sequence(pi.startPage, pi.endPage)}" th:value="${page}" th:text="${page}" th:if="${pi.page == page}"></li>
					<li class="pageNo" th:each="page: ${#numbers.sequence(pi.startPage, pi.endPage)}" th:value="${page}" th:text="${page}" th:unless="${pi.page == page}"></li>
					<li class="go_next">&gt;</li>
					<li class="go_end">&gt;&gt;</li>
				</ul> 
			</div>
 			<!-- 페이징 -->
</div>
</div>
<div th:replace="common/footer :: footer"></div>


<script>

//crsf토큰
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");
$(document).ajaxSend(function(e, xhr, options) { xhr.setRequestHeader(header, token); });
  
  
$("tr").click(function(){
    var no = $(this).children().eq(0).children().val();
    openDetail(no);
 });
 

//$("tr").click(function(){
//    var no = $(this).children().eq(0).children().val();
 //   openRpDetail(no);
// })

//detail 가운데로 띄우기. 

var popupWidth = 1080;
var popupHeight = 700;
var popupX = (window.screen.width / 2) - (popupWidth / 2);
// 만들 팝업창 width 크기의 1/2 만큼 보정값으로 빼주었음
var popupY= (window.screen.height / 2) - (popupHeight / 2);
// 만들 팝업창 height 크기의 1/2 만큼 보정값으로 빼주었음

 function openDetail(no){  
    window.open("/manage/reviewMg/rdetail/" + no, "상세보기창", "width=1080, height=700, toolbar=no, menubar=no, scrollbars=yes, resizable=yes"+', left='+ popupX + ', top='+ popupY );  
 }  
 
 function openRpDetail(no){
	    window.open("/manage/reviewMg/rpdetail/" + no, "상세보기창", "width=500, height=500, toolbar=no, menubar=no, scrollbars=yes, resizable=yes"+', left='+ popupX + ', top='+ popupY );  

 }




//allCheck 
$(function(){
   var checkboxes = document.getElementsByName("checkbox");
   var checkCnt = checkboxes.length;
   
   $("input[name='allCheck']").click(function(){
      var check_listArr = $("input[name='checkbox']");
      for (var i=0; i<check_listArr.length; i++){
         check_listArr[i].checked = this.checked;
      }
   });
   $("input[name='checkbox']").click(function(){
      if($("input[name='checkbox']:checked").length == checkCnt){
         $("input[name='allCheck']")[0].checked = true;
      }
      else{
         $("input[name='allCheck']")[0].checked = false;
      }
   });
});


function deleteValue(){
    var valueArr = new Array();
    var list = $("input[name='checkbox']");
    
    console.log("리뷰넘버값: " + list);
    
    for(var i = 0; i < list.length; i++){
        if(list[i].checked){ 
            valueArr.push(list[i].value);
        // Array.push(), Array.unshift(), Array.splice() 
        //콘솔값 잘 나옴. 
        //console.log(valueArr);
        //console.log(valueArr.length);
        }
    }
    if (valueArr.length == 0){
       alert("선택된 회원이 없습니다.");
    }
    else{
    	var chk = confirm("정말 취소하시겠습니까?");	
		if(chk == true){        
      $.ajax({
          url : "/manage/reviewMg/delete",                   
          type : 'POST',  
          contentType: "application/x-www-form-urlencoded; charset=UTF-8",
          traditional : true,
          data : {
             valueArr : valueArr        //403에러는왜뜨는거지? -> csrf때문
          },
          success : function(data){
            alert("삭제에 성공했습니다.");
            location.replace("main")
         },
         error : function(e){
        	 alert("삭제에 실패했습니다");
         }
      });
	 }
   }
 }





</script>  


</body>
</html>