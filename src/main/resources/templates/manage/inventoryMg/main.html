<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>재고관리</title>
<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link href="/css/common/common.css" rel="stylesheet">

    <style>
    * {
          font-family: 'Gowun Batang', serif;
       }
       
    #container {
            width: 1100px;
		    margin: 0 auto;
		    display: flex;
		    justify-content: space-between;
		    flex-wrap: nowrap;
		    border: none;
		    height: 1400px;
        }

        .snb {
            width: 200px;
            /* height: 2500px; */
            height: 100%;
        }
    	
        .inner {
            margin-top: 30px;
            margin-left: 27px;
            width: 836px;
        }
        a {
            text-decoration: none;
            color: #000;
        }

        .snb {
            width: 210px;
        }

        .snb_inner {
            width: 170px;
            margin: 30px auto 0;
        }
       /* 여기서부터 */
        .content {
            width: 840px;
	    	height: 100%;
        }

        .totalList{
            border: black 1px solid;
            width: 850px;
            height: 120px;
            display: flex;
            list-style: none;
            text-align: center;
            margin-bottom: 10px;
            margin-top: 20px; 
        }
        
        #todayReceiving{
            margin-right: 200px;
            margin-left: 140px;
        }

        #totalShop {
            margin-right: 200px;
        }
      
        #totalStock{
            margin-right: 150px;
        }
        span#count{
           font-size: 45px;
           font-weight: bolder;
           color: #83131E;   
        }
        span#counts{
           font-size: 45px;
           font-weight: bolder;
           color: black;  
        }
        span#countTitle{
           width: 70px;
        }
        .dayArrayBtn{
           margin: 5px;
           background: white ;
           border: 1px solid #83131E ;
           color: #83131E;
           width: 50px;
           height: 25px;
           border-radius: 5px; 
        }

        .dayArrayBtn:hover {
            cursor: pointer;
            transform:scale(1.1);
            background:  #83131E;
            color: white;  
        }
       

        #searchBtn{
           margin: 5px;
           background: white ;
           border: 1px solid #83131E ;
           color: #83131E;
           width: 45px;
           height: 25px;
           border-radius: 5px;
        }
        #searchBtn:hover {
            cursor: pointer;
            transform:scale(1.1);
            background:  #83131E;
            color: white;  
        }
        

        #registBtn{
            float: right;
            background: #83131E ;
            border: none;
            color:white;
            width:80px;
            height: 30px;
            border-radius: 5px;
            margin-right: -10px;
            margin-bottom: 10px;
        }
		
		
		.invenMgList{
            text-align: center;
            margin-top: 30px;
            margin-bottom: 30px;
            width: 900px;
            height: 500px;
        
        }
        
        tbody{
        border: none;
        }
        
        
        .invenMgTable{
       	width: 850px;
	    text-align: center;
	    font-weight: lighter;
	    border-collapse: collapse;
	    border-spacing: 0px;
	    font-size: 14px;
        }

        .invenMgTable th{
        font-weight: lighter;
	    background-color: rgba(196, 196, 196, 0.3);
	    border: none;
        }
        
        .invenMgTable tr {
	    height: 35px;
		}
		
		.invenMgTable tr:nth-child(n+2):hover {
	    background-color: rgba(196, 196, 196, 0.1);
		}

        .invenMgTable td{
        border-bottom:1px solid lightgray;
        border-left: none;
        text-align: center;
        height: 35px;
        font-size: 14px;
        }
      
      #cancleBtn{
        background: white ;
        border: 1px solid #83131E ;
        color: #83131E;
        width: 50px;
        height: 25px;
        border-radius: 8%;  
      }
       th:nth-of-type(4) { display: none; }   
      th:nth-of-type(11) { display: none; } 
      td:nth-of-type(4) { display: none; }  
      td:nth-of-type(11) { display: none; }
      
      
    </style>
</head>
<body>
<header th:include="common/header :: header"></header>
<div id="container">
        <nav class="snb" th:replace="/manage/adminSubmenu.html"></nav>
        <script>
        $(document).ready(function () { 
            $('.inventory').css('background-color', 'rgba(131, 19, 30, 0.2)'); 
            $('.inventory').css('color', 'rgb(131,19,30)'); 
            $('.inventory').css('font-weight', 'bold'); 
        });
        </script>

        
  <div class="content">
       
   <h2>입고관리</h2>    
    <hr>
    <div class="totalList">
     <input type="hidden" name="totalStock" th:value="${totalStock.totalStock}">
     <input type="hidden" name="totalShop" th:value="${totalShop.totalShop}">
     <input type="hidden" name="todayReceiving" th:value="${todayReceiving.todayReceiving}">
  
        <div id="todayReceiving">
            <span id="count" th:text="${todayReceiving.todayReceiving}">9</span>
            <span id="countTitle">Today Receiving</span>
        </div>
        
        <div id="totalShop">
            <span id="counts" th:text="${totalShop.totalShop}"></span> 
            <span id="countTitle">Total Shop</span>
        </div>
        <div id="totalStock">
            <span id="count"  th:text="${totalStock.totalStock}"></span> 
            <span id="countTitle">Total Stock</span>
        </div>
    </div> 
    
    <div class="searchArea">
        <label>기간 조회 : </label>
        <input type="date"> ~ <input type="date">
        <button class="dayArrayBtn">오늘</button>
        <button class="dayArrayBtn">1주일</button>
        <button class="dayArrayBtn">1개월</button>
        <div class="searchArea"><label>조건 검색 : </label>
            <select id="selectCategory" name="search_select">
                    <option value="name">상품명</option>
                    <option value="no">상품번호</option>
                </select>
            <input type="text" id="searchTitle" name="search_product"> 
            <button id="searchBtn">검색</button> 
        </div>

    </div>

        <button id="registBtn"  onclick="location.href='/manage/inventoryMg/regist'">입고</button><br>
        <div class="invenMgList">
            <table class="invenMgTable">
                <tr>
                <th>입고No</th>
                <th>상품No</th>
                <th>상품명(한글)</th>
                <th>상품명(영어)</th>
                <th>판매 가격</th>
                <th>입고 수량</th>
                <th>입고 단가</th>
                <th>지불 금액</th>
                <th>입고일</th>
                <th>기능</th>
                <th>상태</th>
                </tr>
			<tbody class="trArea">                
				<tr class="allinven" th:each="inven: ${ invenList }">
                    <td id="inven_no"  th:text="${ inven.inven_no }"/>
                    <td th:text="${ inven.product_no }"/>
                    <td th:text="${ inven.product_kname }"/>
                    <td th:text="${ inven.product_ename }"/>
                    <td th:text="${#numbers.formatDecimal(inven.sale_price, 0, 'COMMA', 0, 'POINT')}"/>
                    <td th:text="${ inven.inven_count}"/>
                    <td th:text="${#numbers.formatDecimal(inven.inven_cost, 0, 'COMMA', 0, 'POINT')}"/>
                    <td th:text="${#numbers.formatDecimal(inven.inven_price, 0, 'COMMA', 0, 'POINT')}"/>
                    <td th:text="${ #dates.format(inven.inven_date, 'yyyy-MM-dd') }"/>
                    <td><button class="cancleBtn" id="cancleBtn">취소</button></td>
                    <td class="tdStatus" th:text="${ inven.status }"></td>
                </tr>
                </tbody>
            </table>
        </div>
</div>
</div>

    

<div th:replace="common/footer :: footer"></div>
<script>
	//crsf토큰
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	$(document).ajaxSend(function(e, xhr, options) { xhr.setRequestHeader(header, token); });
	
	//날짜포맷함수
	function dateFormat(date) {
			let month = date.getMonth() + 1;
			let day = date.getDate();

			month = month >= 10 ? month : '0' + month;
			day = day >= 10 ? day : '0' + day;

			return date.getFullYear() + '-' + month + '-' + day;
		}
	
	
	//검색
	$("#searchBtn").on("click", function() {
		var searchStandard = $("select[name=search_select]").val();
		var searchValue = $("input[name=search_product]").val();

		var tableHTML;
		$.ajax({
			url : "/manage/inventoryMg/searchMain",
			data : {searchStandard : searchStandard, searchValue : searchValue},
			type : "post",
			success : function(data) {
				if (data.length == 0) {
					alert("검색 결과가 없습니다.");
				} else {
					var tableHTML = '<ul class="selectPno" id="selectPno">';
				
					$.each(data, function(index, item) {
						let inven_date = new Date(item.inven_date);
						
						tableHTML += "<tr class='allinven'><td id='inven_no'>" + item.inven_no + "</td>"
                        + "<td>"+ item.product_no + "</td>"
                        + "<td>"+ item.product_kname + "</td>"
                        + "<td>"+ item.product_ename + "</td>"
                        + "<td>"+ item.sale_price + "</td>"
                        + "<td>"+ item.inven_count + "</td>"
                        + "<td>"+ item.inven_cost + "</td>"
                        + "<td>"+ item.inven_price + "</td>"
                        + "<td>"+ dateFormat(inven_date)+ "</td>"
                        + "<td><button class='cancleBtn' id='cancleBtn'>취소</btton></td>"
                        + "<td>"+ item.status + "</td></tr>";

              			 $(".trArea").html(tableHTML);
              				changeCss();
					});
					//?
				}
			},
			error : function(e) {
				console.log(e);
			}						
		});
	});
	
	function changeCss(){
		$(".trArea tr").each(function(){
			   var status = $(this).children().eq(10).text();
			   var cancleBtn = $(this).children().eq(9).children();
			   
			   console.log(status);
			   
			   if(status == 'N'){
			       $(this).css('background', 'rgba(180,19,30,0.1)');
			       $(this).css("text-decoration", "line-through");
			       cancleBtn.hide();
			       
			    }else{
			       $(this).css('background', 'none');
			       cancleBtn.show();
			    }
		});
	}

	
	
	
	
//입고주문취소
	$(".cancleBtn").click(function(){
		var inven_no= $(this).parent().parent().children().eq(0).text();
		
		var chk = confirm("정말 취소하시겠습니까?");	
		if(chk == true){
		
		$.ajax({
			url : "/manage/inventoryMg/cancle",
			data : {inven_no, inven_no},
			type : "post",
			success : function(data) {
				alert("입고주문 취소를 성공하셨습니다.");
				location.reload();
			},
			error : function(e) {
				alert("입고주문 취소에 실패하셨습니다.");
				console.log(e);
			}						
		});
	  }
	}); 
	
	
	
	//관련 css
$(function(){	
   $(".trArea tr").each(function(){
	   var status = $(this).children().eq(10).text();
	   var cancleBtn = $(this).children().eq(9).children();
	   
	   console.log(status);
	   
	   if(status == 'N'){
	       $(this).css('background', 'rgba(180,19,30,0.1)');
	       $(this).css("text-decoration", "line-through");
	       cancleBtn.hide();
	       
	    }else{
	       $(this).css('background', 'none');
	       cancleBtn.show();
	    }
   });
 });

</script>
</body>
</html>